<div class="row">
    <div class="col-md-4 d-none d-md-block">
        <div class="hov-img-zoom">
            <img src="{{ asset( image_cuvee_location ~ vintage.cuvee.imagePath) }}" alt="no image">
        </div>

    </div>
    <div class="col-md-8 p-r-30">
        <h4 class="title-main t-center txt5 m-b-18">
            {{ vintage.cuvee.name }} {{ vintage.year }}
        </h4>

        <table class="table">
            <thead>
            <tr>
                <th scope="col">Type</th>
                <th scope="col">Prix</th>
                <th scope="col">Quantité</th>
            </tr>
            </thead>
            <tbody>
            {% for bottle in vintage.bottles %}
                <tr>
                    <td>{{ bottle.capacity.name}}</td>
                    <td>{{ bottle.price|number_format(2) }} €</td>
                    <td>
                        {% if bottle.available %}
                            <input size="4" name="bottle_{{ bottle.id }}" type="number" value="{{ bottlesOrdered[bottle.id] is defined ?  bottlesOrdered[bottle.id] : 0 }}">
                        {% else %}
                            <i>indisponible</i>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="t-right">
            <button id="add-to-cart-button" type="submit">
                Ajouter au panier <i class="fa fa-shopping-basket" aria-hidden="true"></i>
            </button>
            <div id="result-add-to-cart">
            </div>
        </div>
    </div>
</div>

<script>
    $( "#add-to-cart-button" ).click(() => {
        $('#result-add-to-cart').html('<div class="loader-wrapper" id="loader-1-s-2"><div id="loader"></div><\div>');
        const bottles = [];
        $(':input[name^=\'bottle_\']').each((index, elem) => {
            bottles[$(elem).attr('name').substring(7)] = $(elem).val();
            console.log($(elem).attr('name')+ " => "+ $(elem).attr('name').substring(7)+ " => "+ $(elem).val());
        });

        $.ajax({
            url: Routing.generate('client_wine_partial_bottle_update'),
            type: "POST",
            data: {bottles:bottles},
            success: (data) => {
                $('#result-add-to-cart').html('Ajouté avec succès');
            },
            error: (results, status, error) => {
                $('#result-add-to-cart').html('Une erreur est survenue');
            }
        });
    });
</script>
